---
title: 2.4.13
tags: Sort
date: 2018-08-19 17:13:22
---

# 题目

2.4.13
想办法在 sink() 中避免检查 j<N。

# 解答

在官方实现的基础上直接删除 j<N 语句，随后在 DelMax() 方法中在 `sink(1)` 之前让 `pq[n + 1] = pq[1]` 即可。
首先观察 DelMax() 方法。

```java
    public Key delMax() {
        if (isEmpty()) throw new NoSuchElementException("Priority queue underflow");
        Key max = pq[1];
        exch(1, n--);
        sink(1);
        pq[n+1] = null;     // to avoid loiterig and help with garbage collection
        if ((n > 0) && (n == (pq.length - 1) / 4)) resize(pq.length / 2);
        assert isMaxHeap();
        return max;
    }
```

首先保存最大值，然后把堆中的第一个元素和最后一个元素交换，随后使 `n = n - 1`。
到这一步之后，堆中元素都满足 `pq[i] <= pq[n + 1]`，即`pq[n] <= pq[n + 1]`。
随后让 `pq[n + 1] = pq[1]`，此时有 `pq[n] < pq[n + 1]` 恒为 `false`，避免元素下沉到被删除的位置。
故之后的 `sink()` 语句中不再需要进行边界判断，直接删去即可。